
<!DOCTYPE html>
<html lang="english">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />     <meta name="robots" content="" />     <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">     <link rel="stylesheet" type="text/css" href="https://jackmckew.dev/theme/stylesheet/style.min.css"> 
    <link rel="stylesheet" type="text/css" href="https://jackmckew.dev/theme/pygments/github.min.css">
    <link rel="stylesheet" type="text/css" href="https://jackmckew.dev/theme/font-awesome/css/fontawesome.css">
    <link rel="stylesheet" type="text/css" href="https://jackmckew.dev/theme/font-awesome/css/brands.css">
    <link rel="stylesheet" type="text/css" href="https://jackmckew.dev/theme/font-awesome/css/solid.css">
    <link rel="stylesheet" type="text/css" href="https://jackmckew.dev/theme/font-awesome.css">     <script src="https://jackmckew.dev/theme/tipuesearch/jquery.min.js"></script>
    <script src="https://jackmckew.dev/theme/tipuesearch/tipuesearch.min.js"></script>
    <script src="https://jackmckew.dev/theme/tipuesearch/tipuesearch.js"></script>
    <script src="https://jackmckew.dev/theme/tipuesearch/tipuesearch_set.js"></script>
    <link rel="stylesheet" href="https://jackmckew.dev/theme/tipuesearch/tipuesearch.css" />
    <script src="https://jackmckew.dev/tipuesearch_content.js"></script>
    <link href="https://jackmckew.dev/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jack McKew's Blog Atom">     <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon"> <!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-131173168-2', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics --><meta name="author" content="Jack McKew" />
<meta name="description" content="Recently, I was traveling around New Zealand, and noticed in the Maori language they use letters back to back a lot like in the original Maori name for Stratford (&#34;whakaahurangi&#34;). So as any normal person does, I thought, well what town has the most repeated letters, and the idea for …" />
<meta name="keywords" content="python, datascience">


<meta property="og:site_name" content="Jack McKew's Blog"/>
<meta property="og:title" content="Looking for Patterns in City Names &amp; Interactive Plotting"/>
<meta property="og:description" content="Recently, I was traveling around New Zealand, and noticed in the Maori language they use letters back to back a lot like in the original Maori name for Stratford (&#34;whakaahurangi&#34;). So as any normal person does, I thought, well what town has the most repeated letters, and the idea for …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://jackmckew.dev/looking-for-patterns-in-city-names-interactive-plotting.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2019-08-16 06:30:00+10:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://jackmckew.dev/author/jack-mckew.html">
<meta property="article:section" content="Python"/>
<meta property="article:tag" content="python"/>
<meta property="article:tag" content="datascience"/>
<meta property="og:image" content="/jm-photo.jpg">

    <title>Jack McKew's Blog &ndash; Looking for Patterns in City Names &amp; Interactive Plotting</title>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client="
     crossorigin="anonymous"></script>
</head>

<body>
    <aside>
        <div>
            <a href="https://jackmckew.dev">
        <img src="/jm-photo.jpg" alt="Jack McKew's Blog" title="Jack McKew's Blog">
      </a>
            <h1><a href="https://jackmckew.dev">Jack McKew's Blog</a></h1>

            <p>Engineer | Software Developer | Data Scientist</p>            <p>Number of Posts: 110</p>
            <p>Number of Words: 81,726</p>
            <p>Number of Lines of Code 5,763</p>
            <form class="navbar-search" action="/search.html" role="search">
                <input type="text" name="q" id="tipue_search_input" placeholder="Search..">
            </form>
            <style>
                .bmc-button img {
                    height: 34px !important;
                    width: 35px !important;
                    margin-bottom: 1px !important;
                    box-shadow: none !important;
                    border: none !important;
                    vertical-align: middle !important;
                }
                
                .bmc-button {
                    margin-top: 15px !important;
                    margin-bottom: 20px !important;
                    padding: 7px 15px 7px 10px !important;
                    line-height: 35px !important;
                    height: 51px !important;
                    text-decoration: none !important;
                    display: inline-flex !important;
                    color: #ffffff !important;
                    /* background-color: #FF813F !important; */
                    border-radius: 5px !important;
                    border: 1px solid transparent !important;
                    padding: 7px 15px 7px 10px !important;
                    font-size: 22px !important;
                    letter-spacing: 0.6px !important;
                    box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;
                    -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
                    font-family: 'Cookie', cursive !important;
                    -webkit-box-sizing: border-box !important;
                    box-sizing: border-box !important;
                }
                
                .bmc-button:hover,
                .bmc-button:active,
                .bmc-button:focus {
                    -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
                    text-decoration: none !important;
                    box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
                    opacity: 0.85 !important;
                    color: #ffffff !important;
                }
            </style>
            <link href="https://fonts.googleapis.com/css?family=Cookie" rel="stylesheet">
            <!-- <a class="bmc-button btn" target="_blank" href="https://www.buymeacoffee.com/jackmckew"><img src="https://jackmckew.dev/theme/img/pizza.png" alt="🍕"><span style="margin-left:5px;font-size:28px !important;">Buy me a Pizza</span></a> -->
            <nav>
                <ul class="list">
                    <li><a target="https://jackmckew.github.io/" href="https://jackmckew.github.io/">Portfolio</a></li>
                    <li><a target="https://jackmckew.dev/files/Jack_McKew_Resume.pdf" href="https://jackmckew.dev/files/Jack_McKew_Resume.pdf">Resume</a></li>
                </ul>
            </nav>

            <ul class="social">
                <li>
                    <a  class="sc-twitter" href="https://twitter.com/Jac_McQ" target="_blank">
                        <i class="fab fa-twitter">
            </i>
                    </a>
                </li>
                <li>
                    <a  class="sc-linkedin" href="https://www.linkedin.com/in/jack-mckew/" target="_blank">
                        <i class="fab fa-linkedin">
            </i>
                    </a>
                </li>
                <li>
                    <a  class="sc-github" href="https://github.com/JackMcKew" target="_blank">
                        <i class="fab fa-github">
            </i>
                    </a>
                </li>
            </ul>
        </div>


    </aside>
    <main>
        <nav>
            <a href="https://jackmckew.dev"> Home</a>             <a href="/archives.html">Archives</a>             <a href="/categories.html">Categories</a>             <a href="/tags.html">Tags</a>             <a href="/sitemap.xml">Sitemap</a>             <a href="https://jackmckew.dev/feeds/all.atom.xml"> Atom</a>         </nav>
<article class="single">
  <header>
      
    <h1 id="looking-for-patterns-in-city-names-interactive-plotting">Looking for Patterns in City Names & Interactive Plotting</h1>
    <p>
       Posted on Fri 16 August 2019 in <a href="https://jackmckew.dev/category/python.html">Python</a>

        &#8226; 5 min read
    </p>
  </header>


  <div>
    <html lang="en"><head></head><body><p>Recently, I was traveling around New Zealand, and noticed in the Maori language they use letters back to back a lot like in the original Maori name for Stratford ("whakaahurangi"). So as any normal person does, I thought, well what town has the most repeated letters, and the idea for this blog post was born. Before we get into the nitty gritty, here is the output of the analysis!</p>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [28]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># output_file("NZ_City_Letter_Analysis.html")</span>
<span class="c1"># save(p)</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">file_html</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">CDN</span><span class="p">,</span> <span class="s2">"NZ_City_Letter_Analysis"</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">HTML</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[28]:</div>
<div class="output_html rendered_html output_subarea output_execute_result">
<meta charset="utf-8"/>
<title>NZ_City_Letter_Analysis</title>
<script src="https://cdn.pydata.org/bokeh/release/bokeh-1.3.1.min.js" type="text/javascript"></script>
<script type="text/javascript">
            Bokeh.set_log_level("info");
        </script>
<div class="bk-root" data-root-id="1192" id="58e3361f-8aef-4cf7-8d23-0a232c72c24b"></div>
<script id="1434" type="application/json">
          {"9a7c834e-4561-48ee-a338-ba00b9647999":{"roots":{"references":[{"attributes":{"dimension":1,"ticker":{"id":"1211","type":"MercatorTicker"}},"id":"1218","type":"Grid"},{"attributes":{},"id":"1197","type":"LinearScale"},{"attributes":{"attribution":"&amp;copy; &lt;a href=\"https://www.openstreetmap.org/copyright\"&gt;OpenStreetMap&lt;/a&gt; contributors,&amp;copy; &lt;a href=\"https://cartodb.com/attributions\"&gt;CartoDB&lt;/a&gt;","url":"https://tiles.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png"},"id":"1189","type":"WMTSTileSource"},{"attributes":{"text":""},"id":"1232","type":"Title"},{"attributes":{"callback":null,"end":-4000000,"start":-6000000},"id":"1195","type":"Range1d"},{"attributes":{"callback":null,"tooltips":[["Repeated Letter","@letters"],["City Name","@city_name"],["Count","@lettercount"]]},"id":"1191","type":"HoverTool"},{"attributes":{"callback":null,"end":17900000,"start":20000000},"id":"1193","type":"Range1d"},{"attributes":{},"id":"1199","type":"LinearScale"},{"attributes":{"below":[{"id":"1201","type":"MercatorAxis"}],"center":[{"id":"1209","type":"Grid"},{"id":"1218","type":"Grid"}],"left":[{"id":"1210","type":"MercatorAxis"}],"renderers":[{"id":"1225","type":"TileRenderer"},{"id":"1230","type":"GlyphRenderer"}],"title":{"id":"1232","type":"Title"},"toolbar":{"id":"1221","type":"Toolbar"},"x_range":{"id":"1193","type":"Range1d"},"x_scale":{"id":"1197","type":"LinearScale"},"y_range":{"id":"1195","type":"Range1d"},"y_scale":{"id":"1199","type":"LinearScale"}},"id":"1192","subtype":"Figure","type":"Plot"},{"attributes":{},"id":"1219","type":"WheelZoomTool"},{"attributes":{"dimension":"lon"},"id":"1202","type":"MercatorTicker"},{"attributes":{"source":{"id":"1190","type":"ColumnDataSource"}},"id":"1231","type":"CDSView"},{"attributes":{"dimension":"lat"},"id":"1211","type":"MercatorTicker"},{"attributes":{"tile_source":{"id":"1189","type":"WMTSTileSource"}},"id":"1225","type":"TileRenderer"},{"attributes":{"data_source":{"id":"1190","type":"ColumnDataSource"},"glyph":{"id":"1228","type":"Circle"},"hover_glyph":null,"muted_glyph":null,"nonselection_glyph":{"id":"1229","type":"Circle"},"selection_glyph":null,"view":{"id":"1231","type":"CDSView"}},"id":"1230","type":"GlyphRenderer"},{"attributes":{"dimension":"lon"},"id":"1204","type":"MercatorTickFormatter"},{"attributes":{"callback":null,"data":{"city_name":["Kaingapai Hakataramea Station","Abbotsford","Christchurch","Edendale Town District","Earnscleugh Settlement","Flagstaff","Kyeburn Diggings","Christchurch","Kihikihi Town District","Clarks Junction","Kokakoriki","Bell Hill","Benmore Stream","Frankton Junction","Goodwood","Upper Papamoa","Quarry Hills","Sherry River","Simons Pass","Otautau Town District","Murumuru","Five Rivers","Kawakawa Town District","Bexley","Admiralty Bay","Fitzroy"],"latitude":[-5558767.960998884,-5761672.922065697,-5393506.130539223,-5831241.362079489,-5655696.009663975,-5753680.824788744,-5621521.486192067,-5393506.130539223,-4584135.718572788,-5737718.1425425,-4726447.364137138,-5243726.168310261,-5519766.216040407,-4551210.9196918905,-5708527.338604558,-4546515.922191398,-5868929.46316788,-5076469.831602914,-5496444.98987784,-5804419.495079225,-4759941.634140226,-5719131.201735792,-4216097.3615601715,-5365398.062254726,-5004969.470230386,-4728836.17627514],"lettercount":[9,2,3,3,5,3,3,3,6,1,4,4,2,4,4,4,1,4,4,5,4,2,3,1,2,1],"letters":["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],"longitude":[18987394.516745858,18970696.593126863,19217454.72350563,18788874.683951527,18848245.15325427,18978117.8183001,18955853.92014144,19217454.72350563,19519872.710600525,18929879.40939617,19493898.19985525,19102424.620125744,18924313.434856508,19510596.12347424,19004092.44036485,19620060.252314463,18816704.556649845,19228586.67258496,18955853.92014144,18701674.453269962,19495753.45048881,18751768.224126928,19377012.734522317,19154373.75293577,19360314.810903326,19380723.34710893],"sizes":[27,6,9,9,15,9,9,9,18,3,12,12,6,12,12,12,3,12,12,15,12,6,9,3,6,3]},"selected":{"id":"1238","type":"Selection"},"selection_policy":{"id":"1239","type":"UnionRenderers"}},"id":"1190","type":"ColumnDataSource"},{"attributes":{"fill_alpha":{"value":0.1},"fill_color":{"value":"#1f77b4"},"line_alpha":{"value":0.1},"line_color":{"value":"#1f77b4"},"size":{"field":"sizes","units":"screen"},"x":{"field":"longitude"},"y":{"field":"latitude"}},"id":"1229","type":"Circle"},{"attributes":{"formatter":{"id":"1213","type":"MercatorTickFormatter"},"ticker":{"id":"1211","type":"MercatorTicker"}},"id":"1210","type":"MercatorAxis"},{"attributes":{},"id":"1220","type":"SaveTool"},{"attributes":{},"id":"1238","type":"Selection"},{"attributes":{"dimension":"lat"},"id":"1213","type":"MercatorTickFormatter"},{"attributes":{},"id":"1239","type":"UnionRenderers"},{"attributes":{"ticker":{"id":"1202","type":"MercatorTicker"}},"id":"1209","type":"Grid"},{"attributes":{"fill_alpha":{"value":0.05},"fill_color":{"value":"#FF0000"},"line_color":{"value":"#FF0000"},"size":{"field":"sizes","units":"screen"},"x":{"field":"longitude"},"y":{"field":"latitude"}},"id":"1228","type":"Circle"},{"attributes":{"active_drag":"auto","active_inspect":"auto","active_multi":null,"active_scroll":"auto","active_tap":"auto","tools":[{"id":"1191","type":"HoverTool"},{"id":"1219","type":"WheelZoomTool"},{"id":"1220","type":"SaveTool"}]},"id":"1221","type":"Toolbar"},{"attributes":{"formatter":{"id":"1204","type":"MercatorTickFormatter"},"ticker":{"id":"1202","type":"MercatorTicker"}},"id":"1201","type":"MercatorAxis"}],"root_ids":["1192"]},"title":"Bokeh Application","version":"1.3.1"}}
        </script>
<script type="text/javascript">
          (function() {
            var fn = function() {
              Bokeh.safely(function() {
                (function(root) {
                  function embed_document(root) {
                    
                  var docs_json = document.getElementById('1434').textContent;
                  var render_items = [{"docid":"9a7c834e-4561-48ee-a338-ba00b9647999","roots":{"1192":"58e3361f-8aef-4cf7-8d23-0a232c72c24b"}}];
                  root.Bokeh.embed.embed_items(docs_json, render_items);
                
                  }
                  if (root.Bokeh !== undefined) {
                    embed_document(root);
                  } else {
                    var attempts = 0;
                    var timer = setInterval(function(root) {
                      if (root.Bokeh !== undefined) {
                        embed_document(root);
                        clearInterval(timer);
                      }
                      attempts++;
                      if (attempts > 100) {
                        console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
                        clearInterval(timer);
                      }
                    }, 10, root)
                  }
                })(window);
              });
            };
            if (document.readyState != "loading") fn();
            else document.addEventListener("DOMContentLoaded", fn);
          })();
        </script>
</div>
</div>
</div>
</div>
</div>
<p>Firstly, we have to find a dataset of all the town names, and I found a database of all world cities names hosted on Kaggle here: <a href="https://www.kaggle.com/max-mind/world-cities-database">https://www.kaggle.com/max-mind/world-cities-database</a>.</p>
<h2 id="Get-the-data!">Get the data!</h2>
<table class="table table-striped highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># data source https://www.kaggle.com/max-mind/world-cities-database</span>
<span class="n">cities_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'./data/worldcitiespop.csv'</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">','</span><span class="p">,</span> <span class="n">quotechar</span><span class="o">=</span><span class="s1">'"'</span><span class="p">)</span>
<span class="n">cities_df</span> <span class="o">=</span> <span class="n">cities_df</span><span class="p">[</span><span class="n">cities_df</span><span class="p">[</span><span class="s1">'Country'</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"nz"</span><span class="p">]</span>
</code></pre></div>
</td></tr></tbody></table>
<p>After inspecting the data of this data set, we're able to filter out to look at just New Zealand with the prefix of "nz" in the Country column. It must be noted that this data set represents the names of the towns currently, and not the original Maori names (more on this will be covered in a later post). Now we want to extract the town names out of the dataframe with the ones we want to analyze. For ease later on, we will extract this as a dictionary, such that we can assign the value of each to the count of each letter.</p>
<table class="table table-striped highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">nz_cities</span> <span class="o">=</span> <span class="n">cities_df</span><span class="p">[</span><span class="n">cities_df</span><span class="p">[</span><span class="s1">'Country'</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"nz"</span><span class="p">][</span><span class="s1">'AccentCity'</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">nz_dict</span> <span class="o">=</span> <span class="p">{</span> <span class="n">i</span> <span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nz_cities</span> <span class="p">}</span>
</code></pre></div>
</td></tr></tbody></table>
<p>Now we will create an ordered dictionary with the help from the collections package which will store the values of the count for each letter in the town name.</p>
<table class="table table-striped highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">letters</span> <span class="o">=</span> <span class="s1">'ABCDEFGHIJKLMNOPQRSTUVWXYZ'</span>
<span class="n">lcount</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">OrderedDict</span><span class="p">([(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">letters</span><span class="p">]))</span>
</code></pre></div>
</td></tr></tbody></table>
<p>Now it's time for the data crunch. To count how many times a letter repeats in a town name we follow these steps:</p>
<ul>
<li>we create a for loop, to loop through all the city names in the table,</li>
<li>initialise an ordered dictionary similar to above for each city in the value field of that town's dictionary entry</li>
<li>loop through each letter in the town name</li>
<li>check if the letter appears in our letter dictionary (mainly to not count spaces),</li>
<li>Then if the letter does appear, increment the value for that letter by 1.</li>
</ul>
<p>This results in a dictionary for each town name, with the count of repeated letters.</p>
<table class="table table-striped highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">city</span> <span class="ow">in</span> <span class="n">nz_cities</span><span class="p">:</span>
    <span class="n">nz_dict</span><span class="p">[</span><span class="n">city</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">OrderedDict</span><span class="p">([(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">letters</span><span class="p">]))</span>
    <span class="n">city_dict</span> <span class="o">=</span> <span class="n">nz_dict</span><span class="p">[</span><span class="n">city</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">city</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">letters</span><span class="p">:</span>
            <span class="n">city_dict</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div>
</td></tr></tbody></table>
<p>Hooray! Now we have all the data we need broken down and ready for analysis. To help ease the analysis and make it more readable for a human, we convert from our nested dictionaries to a pandas dataframe and transpose it such that we have the town name as the index, the letters as the column and the count of that letter as the values.</p>
<table class="table table-striped highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">total_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">nz_dict</span><span class="p">)</span>
<span class="n">total_df</span> <span class="o">=</span> <span class="n">total_df</span><span class="o">.</span><span class="n">T</span>
</code></pre></div>
</td></tr></tbody></table>
<p>Now we want to find which of these names have the maximum count for any particular letter and store it in a summary dataframe. It is to be noted that we could use the pivot function with aggregate types, however, I have not figured a nice way to do this yet. If you do know a nicer way to determine this, please let me know.</p>
<table class="table table-striped highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">summary_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">summary_df</span><span class="p">[</span><span class="s1">'City_Name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_df</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
<span class="n">summary_df</span><span class="p">[</span><span class="s1">'Count'</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">total_df</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</code></pre></div>
</td></tr></tbody></table>
<p>Now by using the equivalent of an index-match in excel which you can read more about here (<a href="https://towardsdatascience.com/name-your-favorite-excel-function-and-ill-teach-you-its-pandas-equivalent-7ee4400ada9f">https://towardsdatascience.com/name-your-favorite-excel-function-and-ill-teach-you-its-pandas-equivalent-7ee4400ada9f</a>). Admittedly, we could've made the join earlier, but since I use index-match so often in Excel, I wanted to learn how to do the same in pandas. This is achieved by using the map function (which is the equivalent of the index), but by using the index of another dataframe as the argument (the match function), we can rejoin the data set by matching the city name from our original data set.</p>
<table class="table table-striped highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">summary_df</span><span class="p">[</span><span class="s1">'Latitude'</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary_df</span><span class="p">[</span><span class="s1">'City_Name'</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">cities_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">'AccentCity'</span><span class="p">])[</span><span class="s1">'Latitude'</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span> <span class="o">*</span> <span class="n">scale</span>
<span class="n">summary_df</span><span class="p">[</span><span class="s1">'Longitude'</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary_df</span><span class="p">[</span><span class="s1">'City_Name'</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">cities_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">'AccentCity'</span><span class="p">])[</span><span class="s1">'Longitude'</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span> <span class="o">*</span> <span class="n">scale</span>
</code></pre></div>
</td></tr></tbody></table>
<p>Now we have a dataframe that contains:</p>
<ul>
<li>an index of the letters,</li>
<li>the town name with the most repeated letters,</li>
<li>the count of the letters within the name,</li>
<li>the longitude and latitude of the town</li>
</ul>
<p>For plotting with <a href="https://bokeh.pydata.org/en/latest/">Bokeh</a> on a basemap, we need to convert from longitude &amp; latitude to easting and northing. To do this we use the pyproj package to make this very simple.</p>
<table class="table table-striped highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">LongLat_to_EN</span><span class="p">(</span><span class="n">long</span><span class="p">,</span> <span class="n">lat</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">easting</span><span class="p">,</span> <span class="n">northing</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span>
        <span class="n">Proj</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="s1">'epsg:4326'</span><span class="p">),</span> <span class="n">Proj</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="s1">'epsg:3857'</span><span class="p">),</span> <span class="n">long</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">easting</span><span class="p">,</span> <span class="n">northing</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div>
</td></tr></tbody></table>
<p>This function can be used to generate the easting and northing for every town from it's longitude &amp; latitude and add it to the dataframe.</p>
<table class="table table-striped highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">summary_df</span><span class="p">[</span><span class="s1">'E'</span><span class="p">],</span> <span class="n">summary_df</span><span class="p">[</span><span class="s1">'N'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">summary_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">LongLat_to_EN</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">'Longitude'</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">'Latitude'</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</code></pre></div>
</td></tr></tbody></table>
<p>Finally, it's time to plot our findings on a map. Before we initialise the map in <a href="https://bokeh.pydata.org/en/latest/">Bokeh</a>, for most plots, data tables and more in <a href="https://bokeh.pydata.org/en/latest/">Bokeh</a>, we need to put it in the <a href="https://bokeh.pydata.org/en/latest/docs/reference/models/sources.html">ColumnDataSource</a> form. We also initialise the interactivity when the user hovers over the data points on the plot.</p>
<table class="table table-striped highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                        <span class="n">longitude</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">summary_df</span><span class="p">[</span><span class="s1">'E'</span><span class="p">]),</span>
                        <span class="n">latitude</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">summary_df</span><span class="p">[</span><span class="s1">'N'</span><span class="p">]),</span>
                        <span class="n">sizes</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">summary_df</span><span class="p">[</span><span class="s1">'Count'</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">),</span>
                        <span class="n">lettercount</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">summary_df</span><span class="p">[</span><span class="s1">'Count'</span><span class="p">]),</span>
                        <span class="n">city_name</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">summary_df</span><span class="p">[</span><span class="s1">'City_Name'</span><span class="p">]),</span>
                        <span class="n">letters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">summary_df</span><span class="o">.</span><span class="n">index</span><span class="p">)))</span>

<span class="n">hover</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">(</span><span class="n">tooltips</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">"Repeated Letter"</span> <span class="p">,</span> <span class="s2">"@letters"</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"City Name"</span><span class="p">,</span> <span class="s2">"@city_name"</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"Count"</span><span class="p">,</span><span class="s2">"@lettercount"</span><span class="p">)</span>

<span class="p">])</span>
</code></pre></div>
</td></tr></tbody></table>
<p>Finally time for the plot! Now admittedly, I haven't found an easy way to find the limits of the graph, so this was made with a lot of trial and error (If you know a better way, please let me know!).</p>
<table class="table table-striped highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="p">(</span><span class="mi">20000000</span><span class="p">,</span><span class="mi">17900000</span><span class="p">),</span> <span class="n">y_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">6000000</span><span class="p">,</span><span class="o">-</span><span class="mi">4000000</span><span class="p">),</span><span class="n">x_axis_type</span><span class="o">=</span><span class="s2">"mercator"</span><span class="p">,</span> <span class="n">y_axis_type</span><span class="o">=</span><span class="s2">"mercator"</span><span class="p">,</span><span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">hover</span><span class="p">,</span> <span class="s1">'wheel_zoom'</span><span class="p">,</span><span class="s1">'save'</span><span class="p">])</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_tile</span><span class="p">(</span><span class="n">CARTODBPOSITRON</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">'longitude'</span><span class="p">,</span>
         <span class="n">y</span><span class="o">=</span><span class="s1">'latitude'</span><span class="p">,</span>
         <span class="n">size</span><span class="o">=</span><span class="s1">'sizes'</span><span class="p">,</span>
         <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
         <span class="n">line_color</span><span class="o">=</span><span class="s2">"#FF0000"</span><span class="p">,</span>
         <span class="n">fill_color</span><span class="o">=</span><span class="s2">"#FF0000"</span><span class="p">,</span>
         <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
</code></pre></div>
</td></tr></tbody></table></body></html>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://jackmckew.dev/tag/python.html">python</a>
      <a href="https://jackmckew.dev/tag/datascience.html">datascience</a>
    </p>
  </div>


  <div class="neighbors">
    <a class="btn float-left" href="https://jackmckew.dev/pycon-au-2019-sunday-in-summary.html" title="PyCon AU 2019 Sunday In Summary">
      <i class="fa fa-angle-left"></i>  Previous Post
    </a>
    <a class="btn float-right" href="https://jackmckew.dev/intro-to-web-scraping.html" title="Intro to Web Scraping">
       Next Post <i class="fa fa-angle-right"></i>
    </a>
  </div>

  <div class="related-posts">
    <h4> You might enjoy</h4>
    <ul class="related-posts">
      <li><a href="https://jackmckew.dev/differential-privacy.html">Differential Privacy</a></li>
      <li><a href="https://jackmckew.dev/shallow-vs-deep-copy-in-python.html">Shallow vs Deep Copy in Python</a></li>
      <li><a href="https://jackmckew.dev/types-of-averages-means.html">Types of Averages (Means)</a></li>
      <li><a href="https://jackmckew.dev/dataclasses-vs-attrs-vs-pydantic.html">Dataclasses vs Attrs vs Pydantic</a></li>
      <li><a href="https://jackmckew.dev/generators-in-python.html">Generators in Python</a></li>
    </ul>
  </div>


<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'jackmckew-dev';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
     Please enable JavaScript to view comments.
</noscript>
<!-- End Disqus -->
</article>

        <footer>
<p>&copy;  </p>
<p> Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme</p>        </footer>
    </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Jack McKew's Blog ",
  "url" : "https://jackmckew.dev",
  "image": "/jm-photo.jpg",
  "description": ""
}
</script>    <script>
        $(document).ready(function() {
            $('#tipue_search_input').tipuesearch();
        });
    </script>
</body>

</html>