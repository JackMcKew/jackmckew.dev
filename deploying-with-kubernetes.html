
<!DOCTYPE html>
<html lang="english">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />     <meta name="robots" content="" />     <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">     <link rel="stylesheet" type="text/css" href="https://jackmckew.dev/theme/stylesheet/style.min.css"> 
    <link rel="stylesheet" type="text/css" href="https://jackmckew.dev/theme/pygments/github.min.css">
    <link rel="stylesheet" type="text/css" href="https://jackmckew.dev/theme/font-awesome/css/fontawesome.css">
    <link rel="stylesheet" type="text/css" href="https://jackmckew.dev/theme/font-awesome/css/brands.css">
    <link rel="stylesheet" type="text/css" href="https://jackmckew.dev/theme/font-awesome/css/solid.css">
    <link rel="stylesheet" type="text/css" href="https://jackmckew.dev/theme/font-awesome.css">     <script src="https://jackmckew.dev/theme/tipuesearch/jquery.min.js"></script>
    <script src="https://jackmckew.dev/theme/tipuesearch/tipuesearch.min.js"></script>
    <script src="https://jackmckew.dev/theme/tipuesearch/tipuesearch.js"></script>
    <script src="https://jackmckew.dev/theme/tipuesearch/tipuesearch_set.js"></script>
    <link rel="stylesheet" href="https://jackmckew.dev/theme/tipuesearch/tipuesearch.css" />
    <script src="https://jackmckew.dev/tipuesearch_content.js"></script>
    <link href="https://jackmckew.dev/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jack McKew's Blog Atom">     <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon"> <!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-131173168-2', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics --><meta name="author" content="Jack McKew" />
<meta name="description" content="Following on with previous posts on this blog. This post will be going through how to deploy our fibonacci application we previously built in a Kubernetes cluster. To reiterate we will be using the following technologies: Technology Use Docker Docker will be used to containerization of the services inside our …" />
<meta name="keywords" content="software">


<meta property="og:site_name" content="Jack McKew's Blog"/>
<meta property="og:title" content="Deploying with Kubernetes"/>
<meta property="og:description" content="Following on with previous posts on this blog. This post will be going through how to deploy our fibonacci application we previously built in a Kubernetes cluster. To reiterate we will be using the following technologies: Technology Use Docker Docker will be used to containerization of the services inside our …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://jackmckew.dev/deploying-with-kubernetes.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2020-11-26 00:00:00+11:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://jackmckew.dev/author/jack-mckew.html">
<meta property="article:section" content="Software"/>
<meta property="article:tag" content="software"/>
<meta property="og:image" content="https://jackmckew.dev/img/google-cloud-kubernetes.gif">

    <title>Jack McKew's Blog &ndash; Deploying with Kubernetes</title>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client="
     crossorigin="anonymous"></script>
</head>

<body>
    <aside>
        <div>
            <a href="https://jackmckew.dev">
        <img src="/jm-photo.jpg" alt="Jack McKew's Blog" title="Jack McKew's Blog">
      </a>
            <h1><a href="https://jackmckew.dev">Jack McKew's Blog</a></h1>

            <p>Engineer | Software Developer | Data Scientist</p>            <p>Number of Posts: 110</p>
            <p>Number of Words: 81,726</p>
            <p>Number of Lines of Code 5,763</p>
            <form class="navbar-search" action="/search.html" role="search">
                <input type="text" name="q" id="tipue_search_input" placeholder="Search..">
            </form>
            <style>
                .bmc-button img {
                    height: 34px !important;
                    width: 35px !important;
                    margin-bottom: 1px !important;
                    box-shadow: none !important;
                    border: none !important;
                    vertical-align: middle !important;
                }
                
                .bmc-button {
                    margin-top: 15px !important;
                    margin-bottom: 20px !important;
                    padding: 7px 15px 7px 10px !important;
                    line-height: 35px !important;
                    height: 51px !important;
                    text-decoration: none !important;
                    display: inline-flex !important;
                    color: #ffffff !important;
                    /* background-color: #FF813F !important; */
                    border-radius: 5px !important;
                    border: 1px solid transparent !important;
                    padding: 7px 15px 7px 10px !important;
                    font-size: 22px !important;
                    letter-spacing: 0.6px !important;
                    box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;
                    -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
                    font-family: 'Cookie', cursive !important;
                    -webkit-box-sizing: border-box !important;
                    box-sizing: border-box !important;
                }
                
                .bmc-button:hover,
                .bmc-button:active,
                .bmc-button:focus {
                    -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
                    text-decoration: none !important;
                    box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
                    opacity: 0.85 !important;
                    color: #ffffff !important;
                }
            </style>
            <link href="https://fonts.googleapis.com/css?family=Cookie" rel="stylesheet">
            <!-- <a class="bmc-button btn" target="_blank" href="https://www.buymeacoffee.com/jackmckew"><img src="https://jackmckew.dev/theme/img/pizza.png" alt="🍕"><span style="margin-left:5px;font-size:28px !important;">Buy me a Pizza</span></a> -->
            <nav>
                <ul class="list">
                    <li><a target="https://jackmckew.github.io/" href="https://jackmckew.github.io/">Portfolio</a></li>
                    <li><a target="https://jackmckew.dev/files/Jack_McKew_Resume.pdf" href="https://jackmckew.dev/files/Jack_McKew_Resume.pdf">Resume</a></li>
                </ul>
            </nav>

            <ul class="social">
                <li>
                    <a  class="sc-twitter" href="https://twitter.com/Jac_McQ" target="_blank">
                        <i class="fab fa-twitter">
            </i>
                    </a>
                </li>
                <li>
                    <a  class="sc-linkedin" href="https://www.linkedin.com/in/jack-mckew/" target="_blank">
                        <i class="fab fa-linkedin">
            </i>
                    </a>
                </li>
                <li>
                    <a  class="sc-github" href="https://github.com/JackMcKew" target="_blank">
                        <i class="fab fa-github">
            </i>
                    </a>
                </li>
            </ul>
        </div>


    </aside>
    <main>
        <nav>
            <a href="https://jackmckew.dev"> Home</a>             <a href="/archives.html">Archives</a>             <a href="/categories.html">Categories</a>             <a href="/tags.html">Tags</a>             <a href="/sitemap.xml">Sitemap</a>             <a href="https://jackmckew.dev/feeds/all.atom.xml"> Atom</a>         </nav>
<article class="single">
  <header>
      
    <h1 id="deploying-with-kubernetes">Deploying with Kubernetes</h1>
    <p>
       Posted on Thu 26 November 2020 in <a href="https://jackmckew.dev/category/software.html">Software</a>

        &#8226; 4 min read
    </p>
  </header>


  <div>
    <body><p>Following on with previous posts on this blog. This post will be going through how to deploy our fibonacci application we previously built in a Kubernetes cluster. To reiterate we will be using the following technologies:</p>
<table class="table table-striped">
<thead>
<tr>
<th>Technology</th>
<th>Use</th>
</tr>
</thead>
<tbody>
<tr>
<td>Docker</td>
<td>Docker will be used to containerization of the services inside our app</td>
</tr>
<tr>
<td>Vue</td>
<td>Vue is the front-end JavaScript framework that we will use</td>
</tr>
<tr>
<td>Google Cloud</td>
<td>The cloud provider that will host our Kubernetes cluster</td>
</tr>
<tr>
<td>Express</td>
<td>Express is responsible for the API between Redis, PostgreSQL and Vue</td>
</tr>
<tr>
<td>Redis</td>
<td>Redis will store/retrieve any local data used by our users</td>
</tr>
<tr>
<td>PostgreSQL</td>
<td>PostgreSQL will be our database</td>
</tr>
<tr>
<td>Nginx</td>
<td>Nginx will handle the routing between our services</td>
</tr>
<tr>
<td>Github Actions</td>
<td>The CI/CD for our project</td>
</tr>
</tbody>
</table>
<p>This post is apart of a series on Docker/Kubernetes, find the other posts at:</p>
<ul>
<li><a href="https://jackmckew.dev/intro-to-docker.html">Intro to Docker</a></li>
<li><a href="https://jackmckew.dev/develop-and-deploy-with-docker.html">Develop and Develop with Docker</a></li>
<li><a href="https://jackmckew.dev/develop-and-deploy-multi-container-applications.html">Develop and Develop Multi Container Applications</a></li>
<li><a href="https://jackmckew.dev/intro-to-kubernetes.html">Intro to Kubernetes</a></li>
<li><a href="https://jackmckew.dev/developing-with-kubernetes.html">Developing with Kubernetes</a></li>
<li><a href="https://jackmckew.dev/deploy-a-node-web-app-to-aws-elastic-beanstalk-with-docker.html">Deploy a Node Web App to AWS Elastic Beanstalk with Docker</a></li>
</ul>
<blockquote>
<p>Previously we made use of services provided by AWS for Redis &amp; PostgreSQL, in this post these services will be run inside their own pods.</p>
</blockquote>
<h2 id="the-architecture">The Architecture</h2>
<p>To make our application run on Kubernetes, we need to make a few changes. In essence though the architecture will</p>
<div class="mermaid">
  graph LR
    subgraph Node
        tr&gt;Traffic] --&gt; is[Ingress Service]

        is --&gt; cl[Client Deployment]

        is --&gt; se[Server Deployment]

        se --&gt; re[(Redis Deployment)]

        se --&gt; po[(PostgreSQL Deployment)]

        po --&gt; pv[PostgreSQL PVC]

        wo(Worker Deployment) --&gt; re
    end
</div>
<blockquote>
<p>The above chart was made with <a href="https://mermaid-js.github.io/mermaid/#/">mermaid.js</a>.</p>
</blockquote>
<p>See the following posts for developing in different contexts:</p>
<ul>
<li>Container context: <a href="https://jackmckew.dev/develop-and-deploy-multi-container-applications.html">Develop and Develop Multi Container Applications</a></li>
<li>Kubernetes context: <a href="https://jackmckew.dev/developing-with-kubernetes.html">Developing with Kubernetes</a></li>
</ul>
<h2 id="cloud-provider">Cloud Provider</h2>
<p>To deploy our Kubernetes cluster, we need a cloud provider, for this post we will be using Google Cloud. Other options are:</p>
<ul>
<li>Amazon Web Services (AWS)</li>
<li>Digital Ocean</li>
<li>Microsoft Azure</li>
<li>Many more</li>
</ul>
<h2 id="google-cloud">Google Cloud</h2>
<p>Now that we've logged into our Google Cloud console, we create a new project, enable billing and then head to Kubernetes Engine. This will go through some one time set up to enable the Kubernetes Engine API for our project and upon completion we can create a cluster. As soon as we hit <code>Create Cluster</code>, this begins the billing so be careful!</p>
<h3 id="service-account">Service Account</h3>
<p>Before moving onto the next step, we need to authorize Github Actions to be able run inside the cluster on Google Cloud. This is done by creating a service account, exporting the keys as JSON and storing it as a secret within the repository on Github.</p>
<h2 id="cicd">CI/CD</h2>
<p>For our CI/CD we will be using GitHub Actions. Github Actions are free to public repositories, and I presented at PyconAU 2020 on the topic, find the recording at: <a href="https://www.youtube.com/watch?v=7aBjzZkaGhU&amp;feature=emb_logo">https://www.youtube.com/watch?v=7aBjzZkaGhU&amp;feature=emb_logo</a>.</p>
<p>Let's get into setting up the action for this project, we will be aiming to achieve a few things in this action:</p>
<ol>
<li>Initialise &amp; configure the Google Cloud SDK</li>
<li>Login to Docker Hub so we can push our images up</li>
<li>Build our application and run tests</li>
<li>Build and tag images ready to be pushed to Docker Hub</li>
<li>Push our tagged images to Docker Hub</li>
<li>Update the Kubernetes configuration on Google Cloud</li>
</ol>
<p>To see the full configuration which achieves this head to: <a href="https://github.com/JackMcKew/multi-docker/blob/master/.github/workflows/google-cloud-cluster.yaml">https://github.com/JackMcKew/multi-docker/blob/master/.github/workflows/google-cloud-cluster.yaml</a>.</p>
<p>We make sure to use the <code>${GITHUB_SHA}</code>, when we're tagging our images versions, this is due to ensure that our kubernetes cluster ensures to update the images when we are running <code>kubectl apply -f k8s</code>. If we didn't add the SHA, they would be all tagged with <code>:latest</code>, and kubernetes wouldn't see an update.</p>
<blockquote>
<p>Make sure to update the cluster id in the command <code>gcloud container clusters get-credentials my-first-cluster-1</code> with the cluster desired to update the kubernetes configuration, otherwise there'll be errors.</p>
</blockquote>
<p>Once this action has successfully completed, we can head to the Workloads page of our project and we should be able to see all the deployment configurations that we set up to be deployed.</p>
<h2 id="setting-up-ingress-nginx">Setting up Ingress-Nginx</h2>
<p>Before we can access our application through an IP or web address, we need to set up <code>ingress-nginx</code>, similar to how we did with <code>docker-compose</code> in previous posts. Luckily, we can make use of <code>helm</code> to add this functionality for us (provided we'd set up nginx configuration like we already have). This can be done by sshing into the terminal of our Kubernetes cluster, or similarly making use of the Cloud Shell provided by Google Cloud.</p>
<p>Firstly which we need to install helm (<a href="https://helm.sh/docs/intro/install/#from-script">https://helm.sh/docs/intro/install/#from-script</a>):</p>
<table class="table table-striped highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3
chmod <span class="m">700</span> get_helm.sh
./get_helm.sh
</code></pre></div>
</td></tr></tbody></table>
<p>Followed by setting up <code>ingress-nginx</code> (<a href="https://kubernetes.github.io/ingress-nginx/deploy/#using-helm">https://kubernetes.github.io/ingress-nginx/deploy/#using-helm</a>):</p>
<table class="table table-striped highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
helm install my-release ingress-nginx/ingress-nginx
</code></pre></div>
</td></tr></tbody></table>
<h2 id="success">Success</h2>
<p>Now we head to our <code>Services &amp; Ingress</code> page in our project, where we can see all the pods that are used for hosting endpoints. Provided the <code>ingress-nginx</code> service has been created, there should be a <code>External Load Balancer</code> service with an IP, that we can access. Heading to this IP will lead us to our application!</p>
<p><img alt="Kubernetes In Action on Google Cloud" class="img-fluid" src="https://jackmckew.dev/img/google-cloud-kubernetes.gif"/></p>
<blockquote>
<p>If we wanted to set up an actual web address, we'd need to purchase a domain, set the A record as the IP for our external load balancer, and finally set up a certificate manager to handle the https authentication.</p>
</blockquote>
<p>Javascript Source(s):
<a href="https://jackmckew.dev/js/mermaid.min.js">mermaid.min.js</a></p></body>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://jackmckew.dev/tag/software.html">software</a>
    </p>
  </div>


  <div class="neighbors">
    <a class="btn float-left" href="https://jackmckew.dev/developing-with-kubernetes.html" title="Developing with Kubernetes">
      <i class="fa fa-angle-left"></i>  Previous Post
    </a>
    <a class="btn float-right" href="https://jackmckew.dev/deploy-a-node-web-app-to-aws-elastic-beanstalk-with-docker.html" title="Deploy a Node Web App to AWS Elastic Beanstalk with Docker">
       Next Post <i class="fa fa-angle-right"></i>
    </a>
  </div>

  <div class="related-posts">
    <h4> You might enjoy</h4>
    <ul class="related-posts">
      <li><a href="https://jackmckew.dev/episode-12-what-is-git.html">Episode 12 - What is Git?</a></li>
    </ul>
  </div>


<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'jackmckew-dev';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
     Please enable JavaScript to view comments.
</noscript>
<!-- End Disqus -->
</article>

        <footer>
<p>&copy;  </p>
<p> Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme</p>        </footer>
    </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Jack McKew's Blog ",
  "url" : "https://jackmckew.dev",
  "image": "/jm-photo.jpg",
  "description": ""
}
</script>    <script>
        $(document).ready(function() {
            $('#tipue_search_input').tipuesearch();
        });
    </script>
</body>
 <script src="https://jackmckew.dev/js/mermaid.min.js"></script>
</html>