  
<!DOCTYPE html>
<html lang="english">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />     <meta name="robots" content="" />      <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">      <link rel="stylesheet" type="text/css" href="https://jackmckew.dev/theme/stylesheet/style.min.css"> 
    <link rel="stylesheet" type="text/css" href="https://jackmckew.dev/theme/pygments/github.min.css">
    <link rel="stylesheet" type="text/css" href="https://jackmckew.dev/theme/font-awesome/css/fontawesome.css">
    <link rel="stylesheet" type="text/css" href="https://jackmckew.dev/theme/font-awesome/css/brands.css">
    <link rel="stylesheet" type="text/css" href="https://jackmckew.dev/theme/font-awesome/css/solid.css">
    <link rel="stylesheet" type="text/css" href="https://jackmckew.dev/theme/font-awesome.css">     <script src="https://jackmckew.dev/theme/tipuesearch/jquery.min.js"></script>
    <script src="https://jackmckew.dev/theme/tipuesearch/tipuesearch.min.js"></script>
    <script src="https://jackmckew.dev/theme/tipuesearch/tipuesearch.js"></script>
    <script src="https://jackmckew.dev/theme/tipuesearch/tipuesearch_set.js"></script>
    <link rel="stylesheet" href="https://jackmckew.dev/theme/tipuesearch/tipuesearch.css" />
    <script src="https://jackmckew.dev/tipuesearch_content.js"></script>
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">   <!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-131173168-2', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->   <meta name="author" content="admin" />
<meta name="description" content="Following last 2 weeks’ posts (Python for the Finance Industry &amp; Portfolio Balancing with Historical Stock Data), we now know how to extract historical records on stock information from the ASX through an API, present it in a graph using matplotlib, and how to balance a portfolio using randomly generated portfolios …" />
<meta name="keywords" content="python, data, analysis">


<meta property="og:site_name" content="Jack McKew's Blog"/>
<meta property="og:title" content="Efficient Frontier for Balancing Portfolios"/>
<meta property="og:description" content="Following last 2 weeks’ posts (Python for the Finance Industry &amp; Portfolio Balancing with Historical Stock Data), we now know how to extract historical records on stock information from the ASX through an API, present it in a graph using matplotlib, and how to balance a portfolio using randomly generated portfolios …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://jackmckew.dev/efficient-frontier-for-balancing-portfolios.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2019-04-26 06:30:00+10:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://jackmckew.dev/author/admin.html">
<meta property="article:section" content="Python"/>
<meta property="article:tag" content="python"/>
<meta property="article:tag" content="data"/>
<meta property="article:tag" content="analysis"/>
<meta property="og:image" content="/jm-photo.jpg">

    <title>Jack McKew's Blog &ndash; Efficient Frontier for Balancing Portfolios</title>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-1052275056735196",
            enable_page_level_ads: true
        });
    </script>
 </head>

<body>
    <aside>
        <div>
            <a href="https://jackmckew.dev">
        <img src="/jm-photo.jpg" alt="Jack McKew's Blog" title="Jack McKew's Blog">
      </a>
            <h1><a href="https://jackmckew.dev">Jack McKew's Blog</a></h1>

            <p>Python enthusiast, electrical engineer and tinkerer</p>             <form class="navbar-search" action="/search.html" role="search">
                <input type="text" name="q" id="tipue_search_input" placeholder="Search..">
            </form>
            <nav>
                <ul class="list">
                        <li><a target="_blank" href="https://jackmckew.dev/pages/contact.html#contact">Contact</a></li>
                    <li><a target="_blank" href="https://jackmckew.dev/pages/cv-professional.html#cv-professional">CV/Professional</a></li>
                  </ul>
            </nav>

            <ul class="social">
                <li>
                    <a  class="sc-twitter" href="https://twitter.com/Jac_McQ" target="_blank">
                        <i class="fab fa-twitter">
            </i>
                    </a>
                </li>
                <li>
                    <a  class="sc-linkedin" href="https://www.linkedin.com/in/jack-mckew/" target="_blank">
                        <i class="fab fa-linkedin">
            </i>
                    </a>
                </li>
                <li>
                    <a  class="sc-github" href="https://github.com/JackMcKew" target="_blank">
                        <i class="fab fa-github">
            </i>
                    </a>
                </li>
            </ul>
        </div>

        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle ads-aside" data-ad-client="ca-pub-1052275056735196" data-ad-slot="1234561"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>

    </aside>
    <main>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle ads-responsive" data-ad-client="ca-pub-1052275056735196" data-ad-slot="1234562"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
         <nav>
            <a href="https://jackmckew.dev"> Home </a>             <a href="/archives.html">Archives</a>             <a href="/categories.html">Categories</a>             <a href="/tags.html">Tags</a>             <a href="/sitemap.xml">Sitemap</a>           </nav>
 <article class="single">
  <header>
      
    <h1 id="efficient-frontier-for-balancing-portfolios">Efficient Frontier for Balancing Portfolios</h1>
    <p>
       Posted on Fri 26 April 2019 in <a href="https://jackmckew.dev/category/python.html">Python</a> 

        &#8226; 5 min read
    </p>
  </header>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle ads-responsive"
         data-ad-client="ca-pub-1052275056735196"
         data-ad-slot="1234565"></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>

  <div>
    </head><body><p>Following last 2 weeks’ posts (<a href="https://jmckew.com/2019/04/12/python-for-the-finance-industry/">Python for the Finance Industry</a> &amp; <a href="https://jmckew.com/2019/04/19/portfolio-balancing-with-historical-stock-data/">Portfolio Balancing with Historical Stock Data</a>), we now know how to extract historical records on stock information from the ASX through an API, present it in a graph using matplotlib, and how to balance a portfolio using randomly generated portfolios.</p>
<p>This post is to demonstrate a method in balancing portfolios that does not depend on generating random portfolios, but rather mathematically determining the extremities of boundaries for effective portfolios using the <a href="https://docs.scipy.org/doc/scipy/reference/tutorial/optimize.html">SciPy optimize function</a> (similar to that of <a href="https://support.office.com/en-ie/article/define-and-solve-a-problem-by-using-solver-5d1a388f-079d-43ac-a7eb-f63e45925040">Excel's 'solver'</a>).</p>
<p>Returning to last weeks' post when the budget allocations to assets were determined from randomly generated portfolios, it was presented on the graph below:</p>
<p><img alt="image-20" class="img-fluid" src="..\img\efficient-frontier-for-balancing-portfolios\image-20.png"/></p>
<p>From this plot, it can be visualized that it forms an arch line between the yellow and red crosses. This line is called the <a href="https://www.investopedia.com/terms/e/efficientfrontier.asp">efficient frontier</a>. The efficient frontier represents the set of optimal portfolios that offer the highest expected return for a defined level of risk or the lowest risk for a given level of expected return. Simply this means, all the dots (portfolios) to the right of the line will give you a higher risk for the same returns.</p>
<p>First of all we must mathematically determine the portfolio with the maximum Sharpe ratio as the greater a portfolio's Sharpe ratio, the better it's risk-adjusted performance. Sharpe ratio is calculated using the formula below:</p>
<p><img alt="" class="img-fluid" src="..\img\efficient-frontier-for-balancing-portfolios\chrome_dUqVqnTloj.png"/></p>
<p>To find the maximum of the Sharpe Ratio programmatically we follow these steps:</p>
<ul>
<li>Firstly, define the formula as the function neg_sharpe_ratio (take note that to find the <a href="https://docs.scipy.org/doc/scipy/reference/tutorial/optimize.html#constrained-minimization-of-multivariate-scalar-functions-minimize">maximum of function in SciPy</a>, we use the minimize function with an inverse sign),</li>
<li>In the max_sharpe_ratio function, define arguments to be passed into the SciPy minimize function:<ul>
<li>neg_sharpe_ratio: function to be minimized,</li>
<li>num*[1/num_assets]: initial guess which is evenly distributed array of values,</li>
<li>Arguments that are to be passed into the objective function (neg_sharpe_ratio),</li>
<li>Method of Sequential Lease Squares Programming, there are <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize.html">many others which can be seen here,</a></li>
<li>Bounds: between 0% and 100% of our budget allocation,</li>
<li>Constraints: given as a dictionary, 'eq' type for equality and 'fun' for the anonymous function which limits the total summed asset allocation to 100% of the budget.</li>
</ul>
</li>
<li>The result from the minimize function is returned as a <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.OptimizeResult.html#scipy.optimize.OptimizeResult">OptimizeResult</a> type.</li>
</ul>
<table class="table-striped table highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="code-line"> 1</span>
<span class="code-line"> 2</span>
<span class="code-line"> 3</span>
<span class="code-line"> 4</span>
<span class="code-line"> 5</span>
<span class="code-line"> 6</span>
<span class="code-line"> 7</span>
<span class="code-line"> 8</span>
<span class="code-line"> 9</span>
<span class="code-line">10</span>
<span class="code-line">11</span>
<span class="code-line">12</span></pre></div></td><td class="code"><div class="highlight"><pre><span class="code-line"><span></span><span class="k">def</span> <span class="nf">neg_sharpe_ratio</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">average_returns</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="p">,</span> <span class="n">risk_free_rate</span><span class="p">):</span></span>
<span class="code-line">    <span class="n">returns</span><span class="p">,</span> <span class="n">volatility</span> <span class="o">=</span> <span class="n">portfolio_performance</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">average_returns</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="p">)</span></span>
<span class="code-line">    <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="n">returns</span> <span class="o">-</span> <span class="n">risk_free_rate</span><span class="p">)</span> <span class="o">/</span> <span class="n">volatility</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">def</span> <span class="nf">max_sharpe_ratio</span><span class="p">(</span><span class="n">average_returns</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="p">,</span><span class="n">risk_free_rate</span><span class="p">):</span></span>
<span class="code-line">    <span class="n">num_assets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">average_returns</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">average_returns</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="p">,</span> <span class="n">risk_free_rate</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">constraints</span> <span class="o">=</span> <span class="p">({</span><span class="s1">'type'</span><span class="p">:</span> <span class="s1">'eq'</span><span class="p">,</span> <span class="s1">'fun'</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">})</span></span>
<span class="code-line">    <span class="n">bound</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">bounds</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">bound</span> <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_assets</span><span class="p">))</span></span>
<span class="code-line">    <span class="n">result</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">neg_sharpe_ratio</span><span class="p">,</span><span class="n">num_assets</span><span class="o">*</span><span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="n">num_assets</span><span class="p">,],</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">'SLSQP'</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span><span class="n">constraints</span><span class="o">=</span><span class="n">constraints</span><span class="p">)</span></span>
<span class="code-line">    <span class="k">return</span> <span class="n">result</span></span>
</pre></div>
</td></tr></tbody></table>
<p>Similarly to the maximum sharpe ratio we do the same for determining the minimum volatility portfolio programmatically. We minimise volatility by trying different weightings on our asset allocations to find the minima.</p>
<table class="table-striped table highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="code-line"> 1</span>
<span class="code-line"> 2</span>
<span class="code-line"> 3</span>
<span class="code-line"> 4</span>
<span class="code-line"> 5</span>
<span class="code-line"> 6</span>
<span class="code-line"> 7</span>
<span class="code-line"> 8</span>
<span class="code-line"> 9</span>
<span class="code-line">10</span>
<span class="code-line">11</span>
<span class="code-line">12</span>
<span class="code-line">13</span></pre></div></td><td class="code"><div class="highlight"><pre><span class="code-line"><span></span><span class="k">def</span> <span class="nf">portfolio_volatility</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">average_returns</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="p">):</span></span>
<span class="code-line">    <span class="k">return</span> <span class="n">portfolio_performance</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">average_returns</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">def</span> <span class="nf">min_variance</span><span class="p">(</span><span class="n">average_returns</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="p">):</span></span>
<span class="code-line">    <span class="n">num_assets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">average_returns</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">average_returns</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">constraints</span> <span class="o">=</span> <span class="p">({</span><span class="s1">'type'</span><span class="p">:</span> <span class="s1">'eq'</span><span class="p">,</span> <span class="s1">'fun'</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">})</span></span>
<span class="code-line">    <span class="n">bound</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">bounds</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">bound</span> <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_assets</span><span class="p">))</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">result</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">portfolio_volatility</span><span class="p">,</span> <span class="n">num_assets</span><span class="o">*</span><span class="p">[</span><span class="mf">1.</span><span class="o">/</span><span class="n">num_assets</span><span class="p">,],</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">'SLSQP'</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">constraints</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">return</span> <span class="n">result</span></span>
</pre></div>
</td></tr></tbody></table>
<p>As above, we can also draw a line which depicts the efficient frontier for the portfolios for a given risk rate. Below some functions are defined for computing the efficient frontier. The first function, efficient_return is calculating the most efficient portfolio for a given target return, and the second function efficient frontier is compiling the most efficient portfolio for a range of targets.</p>
<table class="table-striped table highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="code-line"> 1</span>
<span class="code-line"> 2</span>
<span class="code-line"> 3</span>
<span class="code-line"> 4</span>
<span class="code-line"> 5</span>
<span class="code-line"> 6</span>
<span class="code-line"> 7</span>
<span class="code-line"> 8</span>
<span class="code-line"> 9</span>
<span class="code-line">10</span>
<span class="code-line">11</span>
<span class="code-line">12</span>
<span class="code-line">13</span>
<span class="code-line">14</span>
<span class="code-line">15</span>
<span class="code-line">16</span>
<span class="code-line">17</span>
<span class="code-line">18</span>
<span class="code-line">19</span></pre></div></td><td class="code"><div class="highlight"><pre><span class="code-line"><span></span><span class="k">def</span> <span class="nf">efficient_return</span><span class="p">(</span><span class="n">average_returns</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span></span>
<span class="code-line">    <span class="n">num_assets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">average_returns</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">average_returns</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">def</span> <span class="nf">portfolio_return</span><span class="p">(</span><span class="n">weights</span><span class="p">):</span></span>
<span class="code-line">        <span class="k">return</span> <span class="n">portfolio_performance</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">average_returns</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">constraints</span> <span class="o">=</span> <span class="p">({</span><span class="s1">'type'</span><span class="p">:</span> <span class="s1">'eq'</span><span class="p">,</span> <span class="s1">'fun'</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">portfolio_return</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">target</span><span class="p">},</span></span>
<span class="code-line">                   <span class="p">{</span><span class="s1">'type'</span><span class="p">:</span> <span class="s1">'eq'</span><span class="p">,</span> <span class="s1">'fun'</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">})</span></span>
<span class="code-line">    <span class="n">bounds</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_assets</span><span class="p">))</span></span>
<span class="code-line">    <span class="n">result</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">portfolio_volatility</span><span class="p">,</span> <span class="n">num_assets</span><span class="o">*</span><span class="p">[</span><span class="mf">1.</span><span class="o">/</span><span class="n">num_assets</span><span class="p">,],</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">'SLSQP'</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">constraints</span><span class="p">)</span></span>
<span class="code-line">    <span class="k">return</span> <span class="n">result</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">def</span> <span class="nf">efficient_frontier</span><span class="p">(</span><span class="n">average_returns</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="p">,</span> <span class="n">returns_range</span><span class="p">):</span></span>
<span class="code-line">    <span class="n">efficients</span> <span class="o">=</span> <span class="p">[]</span></span>
<span class="code-line">    <span class="k">for</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">returns_range</span><span class="p">:</span></span>
<span class="code-line">        <span class="n">efficients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">efficient_return</span><span class="p">(</span><span class="n">average_returns</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="p">,</span> <span class="n">ret</span><span class="p">))</span></span>
<span class="code-line">    <span class="k">return</span> <span class="n">efficients</span></span>
</pre></div>
</td></tr></tbody></table>
<p>Now it's time to plot the efficient frontier on the graph with the randomly selected portfolios to check if they have been calculated correctly. It is also an opportune time to check if the maximum Sharpe ratio and minimum volatility portfolios have been calculated correctly by comparing them to the previously randomly determined portfolios.</p>
<table class="table-striped table highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="code-line"> 1</span>
<span class="code-line"> 2</span>
<span class="code-line"> 3</span>
<span class="code-line"> 4</span>
<span class="code-line"> 5</span>
<span class="code-line"> 6</span>
<span class="code-line"> 7</span>
<span class="code-line"> 8</span>
<span class="code-line"> 9</span>
<span class="code-line">10</span>
<span class="code-line">11</span>
<span class="code-line">12</span>
<span class="code-line">13</span>
<span class="code-line">14</span>
<span class="code-line">15</span>
<span class="code-line">16</span>
<span class="code-line">17</span>
<span class="code-line">18</span>
<span class="code-line">19</span>
<span class="code-line">20</span>
<span class="code-line">21</span>
<span class="code-line">22</span>
<span class="code-line">23</span>
<span class="code-line">24</span>
<span class="code-line">25</span>
<span class="code-line">26</span>
<span class="code-line">27</span>
<span class="code-line">28</span>
<span class="code-line">29</span>
<span class="code-line">30</span>
<span class="code-line">31</span>
<span class="code-line">32</span>
<span class="code-line">33</span>
<span class="code-line">34</span>
<span class="code-line">35</span>
<span class="code-line">36</span>
<span class="code-line">37</span>
<span class="code-line">38</span>
<span class="code-line">39</span>
<span class="code-line">40</span>
<span class="code-line">41</span>
<span class="code-line">42</span>
<span class="code-line">43</span>
<span class="code-line">44</span>
<span class="code-line">45</span>
<span class="code-line">46</span>
<span class="code-line">47</span>
<span class="code-line">48</span>
<span class="code-line">49</span>
<span class="code-line">50</span>
<span class="code-line">51</span>
<span class="code-line">52</span>
<span class="code-line">53</span>
<span class="code-line">54</span></pre></div></td><td class="code"><div class="highlight"><pre><span class="code-line"><span></span><span class="k">def</span> <span class="nf">display_efficient_frontier</span><span class="p">(</span><span class="n">average_returns</span><span class="p">,</span><span class="n">covariance_matrix</span><span class="p">,</span><span class="n">num_portfolios</span><span class="p">,</span><span class="n">risk_free_rate</span><span class="p">):</span></span>
<span class="code-line">    <span class="n">results</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="n">generate_portfolios</span><span class="p">(</span><span class="n">num_portfolios</span><span class="p">,</span><span class="n">average_returns</span><span class="p">,</span><span class="n">covariance_matrix</span><span class="p">,</span><span class="n">risk_free_rate</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">max_sharpe</span> <span class="o">=</span> <span class="n">max_sharpe_ratio</span><span class="p">(</span><span class="n">average_returns</span><span class="p">,</span><span class="n">covariance_matrix</span><span class="p">,</span><span class="n">risk_free_rate</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">max_sharpe_return</span><span class="p">,</span> <span class="n">max_sharpe_volatility</span> <span class="o">=</span> <span class="n">portfolio_performance</span><span class="p">(</span><span class="n">max_sharpe</span><span class="p">[</span><span class="s1">'x'</span><span class="p">],</span><span class="n">average_returns</span><span class="p">,</span><span class="n">covariance_matrix</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">max_sharpe_allocations</span> <span class="o">=</span> <span class="n">allocations_ef</span><span class="p">(</span><span class="n">max_sharpe</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">stocks_df</span><span class="p">)</span><span class="o">.</span><span class="n">T</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">print</span><span class="p">(</span><span class="s2">"MAX SHARPE RATIO</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span></span>
<span class="code-line">    <span class="k">print</span><span class="p">(</span><span class="s2">"Return: {0:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_sharpe_return</span><span class="p">))</span></span>
<span class="code-line">    <span class="k">print</span><span class="p">(</span><span class="s2">"Volatility: {0:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_sharpe_volatility</span><span class="p">))</span></span>
<span class="code-line">    <span class="k">print</span><span class="p">(</span><span class="n">max_sharpe_allocations</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">min_vol</span> <span class="o">=</span> <span class="n">min_variance</span><span class="p">(</span><span class="n">average_returns</span><span class="p">,</span><span class="n">covariance_matrix</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">min_vol_return</span><span class="p">,</span> <span class="n">min_vol_volatility</span> <span class="o">=</span> <span class="n">portfolio_performance</span><span class="p">(</span><span class="n">min_vol</span><span class="p">[</span><span class="s1">'x'</span><span class="p">],</span><span class="n">average_returns</span><span class="p">,</span><span class="n">covariance_matrix</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">min_vol_allocations</span> <span class="o">=</span> <span class="n">allocations_ef</span><span class="p">(</span><span class="n">min_vol</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">stocks_df</span><span class="p">)</span><span class="o">.</span><span class="n">T</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">MINIMUM VOLATILITY</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span></span>
<span class="code-line">    <span class="k">print</span><span class="p">(</span><span class="s2">"Return: {0:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">min_vol_return</span><span class="p">))</span></span>
<span class="code-line">    <span class="k">print</span><span class="p">(</span><span class="s2">"Volatility: {0:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">min_vol_volatility</span><span class="p">))</span></span>
<span class="code-line">    <span class="k">print</span><span class="p">(</span><span class="n">min_vol_allocations</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">an_vol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">253</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">an_rt</span> <span class="o">=</span> <span class="n">average_returns</span> <span class="o">*</span> <span class="mi">253</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">txt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stocks_df</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span></span>
<span class="code-line">        <span class="k">print</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span><span class="s2">":"</span><span class="p">,</span><span class="s2">"Annuaised return"</span><span class="p">,</span><span class="nb">round</span><span class="p">(</span><span class="n">an_rt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">2</span><span class="p">),</span><span class="s2">", Annualised volatility:"</span><span class="p">,</span><span class="nb">round</span><span class="p">(</span><span class="n">an_vol</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">2</span><span class="p">))</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span></span>
<span class="code-line">    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span><span class="n">c</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">,:],</span><span class="n">cmap</span><span class="o">=</span><span class="s1">'YlGnBu'</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'o'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span></span>
<span class="code-line">    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">max_sharpe_volatility</span><span class="p">,</span><span class="n">max_sharpe_return</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">'X'</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Maximum Sharpe ratio'</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">min_vol_volatility</span><span class="p">,</span><span class="n">min_vol_return</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">'X'</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'y'</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Minimum volatility'</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_vol_return</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">an_rt</span><span class="p">),</span> <span class="mi">50</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">efficient_portfolios</span> <span class="o">=</span> <span class="n">efficient_frontier</span><span class="p">(</span><span class="n">average_returns</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="s1">'fun'</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">efficient_portfolios</span><span class="p">],</span> <span class="n">target</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'-.'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'efficient frontier'</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Calculated Portfolio Optimization based on Efficient Frontier'</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Volatility'</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Returns'</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">def</span> <span class="nf">allocations_ef</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span><span class="n">stocks_df</span><span class="p">):</span></span>
<span class="code-line">    <span class="n">allocation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">stocks_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'allocation'</span><span class="p">])</span></span>
<span class="code-line">    <span class="k">return</span> <span class="n">allocation</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">returns</span> <span class="o">=</span> <span class="n">stocks_df</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span></span>
<span class="code-line"><span class="n">average_returns</span> <span class="o">=</span> <span class="n">returns</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span></span>
<span class="code-line"><span class="n">covariance_matrix</span> <span class="o">=</span> <span class="n">returns</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span></span>
<span class="code-line"><span class="n">num_portfolios</span> <span class="o">=</span> <span class="mi">25000</span></span>
<span class="code-line"><span class="n">risk_free_rate</span> <span class="o">=</span> <span class="mf">0.01977</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">display_efficient_frontier</span><span class="p">(</span><span class="n">average_returns</span><span class="p">,</span><span class="n">covariance_matrix</span><span class="p">,</span><span class="n">num_portfolios</span><span class="p">,</span><span class="n">risk_free_rate</span><span class="p">)</span></span>
</pre></div>
</td></tr></tbody></table>
<p><img alt="Code_lDUKAxc9JU" class="img-fluid" src="..\img\efficient-frontier-for-balancing-portfolios\Code_lDUKAxc9JU.png"/></p>
<p><img alt="Code_R2bA54PriC" class="img-fluid" src="..\img\efficient-frontier-for-balancing-portfolios\Code_R2bA54PriC.png"/></p>
<p>The surprising part is that the calculated result is very close to what we have previously simulated by picking from randomly generated portfolios. The slight differences in allocations between the simulated vs calculated are in most cases less than 1%, which shows how powerful randomly estimating calculations can be albeit sometimes not reliable in small sample spaces.</p>
<p>Rather than plotting every randomly generated portfolio, we can plot the individual stocks on the plot with the corresponding values of each stock's return and risk. This way we can compare how diversification is lowering the risk by optimizing the allocations.</p>
<table class="table-striped table highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="code-line"> 1</span>
<span class="code-line"> 2</span>
<span class="code-line"> 3</span>
<span class="code-line"> 4</span>
<span class="code-line"> 5</span>
<span class="code-line"> 6</span>
<span class="code-line"> 7</span>
<span class="code-line"> 8</span>
<span class="code-line"> 9</span>
<span class="code-line">10</span>
<span class="code-line">11</span>
<span class="code-line">12</span>
<span class="code-line">13</span>
<span class="code-line">14</span>
<span class="code-line">15</span>
<span class="code-line">16</span>
<span class="code-line">17</span>
<span class="code-line">18</span>
<span class="code-line">19</span>
<span class="code-line">20</span>
<span class="code-line">21</span>
<span class="code-line">22</span>
<span class="code-line">23</span>
<span class="code-line">24</span>
<span class="code-line">25</span>
<span class="code-line">26</span>
<span class="code-line">27</span>
<span class="code-line">28</span>
<span class="code-line">29</span>
<span class="code-line">30</span>
<span class="code-line">31</span>
<span class="code-line">32</span>
<span class="code-line">33</span>
<span class="code-line">34</span>
<span class="code-line">35</span>
<span class="code-line">36</span>
<span class="code-line">37</span>
<span class="code-line">38</span>
<span class="code-line">39</span>
<span class="code-line">40</span>
<span class="code-line">41</span>
<span class="code-line">42</span>
<span class="code-line">43</span>
<span class="code-line">44</span>
<span class="code-line">45</span>
<span class="code-line">46</span>
<span class="code-line">47</span></pre></div></td><td class="code"><div class="highlight"><pre><span class="code-line"><span></span><span class="k">def</span> <span class="nf">display_efficient_frontier_selected</span><span class="p">(</span><span class="n">average_returns</span><span class="p">,</span><span class="n">covariance_matrix</span><span class="p">,</span><span class="n">risk_free_rate</span><span class="p">):</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">max_sharpe</span> <span class="o">=</span> <span class="n">max_sharpe_ratio</span><span class="p">(</span><span class="n">average_returns</span><span class="p">,</span><span class="n">covariance_matrix</span><span class="p">,</span><span class="n">risk_free_rate</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">max_sharpe_return</span><span class="p">,</span> <span class="n">max_sharpe_volatility</span> <span class="o">=</span> <span class="n">portfolio_performance</span><span class="p">(</span><span class="n">max_sharpe</span><span class="p">[</span><span class="s1">'x'</span><span class="p">],</span><span class="n">average_returns</span><span class="p">,</span><span class="n">covariance_matrix</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">max_sharpe_allocations</span> <span class="o">=</span> <span class="n">allocations_ef</span><span class="p">(</span><span class="n">max_sharpe</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">stocks_df</span><span class="p">)</span><span class="o">.</span><span class="n">T</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">print</span><span class="p">(</span><span class="s2">"MAX SHARPE RATIO</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span></span>
<span class="code-line">    <span class="k">print</span><span class="p">(</span><span class="s2">"Return: {0:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_sharpe_return</span><span class="p">))</span></span>
<span class="code-line">    <span class="k">print</span><span class="p">(</span><span class="s2">"Volatility: {0:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_sharpe_volatility</span><span class="p">))</span></span>
<span class="code-line">    <span class="k">print</span><span class="p">(</span><span class="n">max_sharpe_allocations</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">min_vol</span> <span class="o">=</span> <span class="n">min_variance</span><span class="p">(</span><span class="n">average_returns</span><span class="p">,</span><span class="n">covariance_matrix</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">min_vol_return</span><span class="p">,</span> <span class="n">min_vol_volatility</span> <span class="o">=</span> <span class="n">portfolio_performance</span><span class="p">(</span><span class="n">min_vol</span><span class="p">[</span><span class="s1">'x'</span><span class="p">],</span><span class="n">average_returns</span><span class="p">,</span><span class="n">covariance_matrix</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">min_vol_allocations</span> <span class="o">=</span> <span class="n">allocations_ef</span><span class="p">(</span><span class="n">min_vol</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">stocks_df</span><span class="p">)</span><span class="o">.</span><span class="n">T</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">MINIMUM VOLATILITY</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span></span>
<span class="code-line">    <span class="k">print</span><span class="p">(</span><span class="s2">"Return: {0:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">min_vol_return</span><span class="p">))</span></span>
<span class="code-line">    <span class="k">print</span><span class="p">(</span><span class="s2">"Volatility: {0:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">min_vol_volatility</span><span class="p">))</span></span>
<span class="code-line">    <span class="k">print</span><span class="p">(</span><span class="n">min_vol_allocations</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">an_vol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">253</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">an_rt</span> <span class="o">=</span> <span class="n">average_returns</span> <span class="o">*</span> <span class="mi">253</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">txt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stocks_df</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span></span>
<span class="code-line">        <span class="k">print</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span><span class="s2">":"</span><span class="p">,</span><span class="s2">"Annuaised return"</span><span class="p">,</span><span class="nb">round</span><span class="p">(</span><span class="n">an_rt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">2</span><span class="p">),</span><span class="s2">", Annualised volatility:"</span><span class="p">,</span><span class="nb">round</span><span class="p">(</span><span class="n">an_vol</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">2</span><span class="p">))</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span></span>
<span class="code-line">    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">an_vol</span><span class="p">,</span><span class="n">an_rt</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">'o'</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">txt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stocks_df</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span></span>
<span class="code-line">        <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="p">(</span><span class="n">an_vol</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">an_rt</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">textcoords</span><span class="o">=</span><span class="s1">'offset points'</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">max_sharpe_volatility</span><span class="p">,</span><span class="n">max_sharpe_return</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">'X'</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Maximum Sharpe ratio'</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">min_vol_volatility</span><span class="p">,</span><span class="n">min_vol_return</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">'X'</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'y'</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Minimum volatility'</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_vol_return</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">an_rt</span><span class="p">),</span> <span class="mi">50</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">efficient_portfolios</span> <span class="o">=</span> <span class="n">efficient_frontier</span><span class="p">(</span><span class="n">average_returns</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="s1">'fun'</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">efficient_portfolios</span><span class="p">],</span> <span class="n">target</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'-.'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'efficient frontier'</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Calculated Portfolio Optimization based on Efficient Frontier'</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Volatility'</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Returns'</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">display_efficient_frontier_selected</span><span class="p">(</span><span class="n">average_returns</span><span class="p">,</span><span class="n">covariance_matrix</span><span class="p">,</span><span class="n">risk_free_rate</span><span class="p">)</span></span>
</pre></div>
</td></tr></tbody></table>
<p><img alt="Code_3sKudlcKG6" class="img-fluid" src="..\img\efficient-frontier-for-balancing-portfolios\Code_3sKudlcKG6.png"/></p>
<p>From the plot above, the stock with the highest risk is BHP, which accompanies the highest returns. This shows that if the investor is willing to take the risk than they will be rewarded with the higher return.</p>
<p>This concludes the 3 part series on Python in the finance industry, if there is any topics in particular you would like to see how software can integrate and improve a service/product please feel free to get in touch!</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://jackmckew.dev/tag/python.html">python</a>
      <a href="https://jackmckew.dev/tag/data.html">data</a>
      <a href="https://jackmckew.dev/tag/analysis.html">analysis</a>
    </p>
  </div>


  <div class="neighbors">
    <a class="btn float-left" href="https://jackmckew.dev/portfolio-balancing-with-historical-stock-data.html" title="Portfolio Balancing with Historical Stock Data">
      <i class="fa fa-angle-left"></i>  Previous Post 
    </a>
    <a class="btn float-right" href="https://jackmckew.dev/what-is-mongodb.html" title="What is MongoDB?">
       Next Post  <i class="fa fa-angle-right"></i>
    </a>
  </div>


    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle ads-responsive"
         data-ad-client="ca-pub-1052275056735196"
         data-ad-slot="1234566"></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>

<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'jackmckew-dev';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
     Please enable JavaScript to view comments. 
</noscript>
<!-- End Disqus -->
</article>

        <footer>
 <p>&copy;  </p>
<p> Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme </p>         </footer>
    </main>

   <script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Jack McKew's Blog ",
  "url" : "https://jackmckew.dev",
  "image": "/jm-photo.jpg",
  "description": ""
}
</script>   <a href="https://github.com/JackMcKew/jackmckew.dev" class="github-corner" aria-label="View source on Github">
    <svg width="80"
         height="80"
         viewBox="0 0 250 250"
         style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;"
         aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor"
              style="transform-origin: 130px 106px;"
              class="octo-arm">
        </path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor"
              class="octo-body">
        </path>
    </svg>
</a>
<style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>      <script>
        $(document).ready(function() {
            $('#tipue_search_input').tipuesearch();
        });
    </script>
</body>

</html>