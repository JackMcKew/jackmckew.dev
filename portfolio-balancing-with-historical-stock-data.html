
<!DOCTYPE html>
<html lang="english">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />     <meta name="robots" content="" />     <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">     <link rel="stylesheet" type="text/css" href="https://jackmckew.dev/theme/stylesheet/style.min.css"> 
    <link rel="stylesheet" type="text/css" href="https://jackmckew.dev/theme/pygments/github.min.css">
    <link rel="stylesheet" type="text/css" href="https://jackmckew.dev/theme/font-awesome/css/fontawesome.css">
    <link rel="stylesheet" type="text/css" href="https://jackmckew.dev/theme/font-awesome/css/brands.css">
    <link rel="stylesheet" type="text/css" href="https://jackmckew.dev/theme/font-awesome/css/solid.css">
    <link rel="stylesheet" type="text/css" href="https://jackmckew.dev/theme/font-awesome.css">     <script src="https://jackmckew.dev/theme/tipuesearch/jquery.min.js"></script>
    <script src="https://jackmckew.dev/theme/tipuesearch/tipuesearch.min.js"></script>
    <script src="https://jackmckew.dev/theme/tipuesearch/tipuesearch.js"></script>
    <script src="https://jackmckew.dev/theme/tipuesearch/tipuesearch_set.js"></script>
    <link rel="stylesheet" href="https://jackmckew.dev/theme/tipuesearch/tipuesearch.css" />
    <script src="https://jackmckew.dev/tipuesearch_content.js"></script>
    <link href="https://jackmckew.dev/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jack McKew's Blog Atom">     <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon"> <!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-131173168-2', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics --><meta name="author" content="Jack McKew" />
<meta name="description" content="Following last weeks&#39; post (Python for the Finance Industry). This post is to demonstrate a method of determining an optimized portfolio based on historical stock price data. First of all while attempting to tackle this problem, I stumbled across many very informative articles in which based on what I learned …" />
<meta name="keywords" content="finance, python">


<meta property="og:site_name" content="Jack McKew's Blog"/>
<meta property="og:title" content="Portfolio Balancing with Historical Stock Data"/>
<meta property="og:description" content="Following last weeks&#39; post (Python for the Finance Industry). This post is to demonstrate a method of determining an optimized portfolio based on historical stock price data. First of all while attempting to tackle this problem, I stumbled across many very informative articles in which based on what I learned …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://jackmckew.dev/portfolio-balancing-with-historical-stock-data.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2019-04-19 06:30:00+10:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://jackmckew.dev/author/jack-mckew.html">
<meta property="article:section" content="Python"/>
<meta property="article:tag" content="finance"/>
<meta property="article:tag" content="python"/>
<meta property="og:image" content="https://cdn-images-1.medium.com/max/1600/1*IabrYvsgHE07z2CJwoE9Zw.jpeg">

    <title>Jack McKew's Blog &ndash; Portfolio Balancing with Historical Stock Data</title>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client="
     crossorigin="anonymous"></script>
</head>

<body>
    <aside>
        <div>
            <a href="https://jackmckew.dev">
        <img src="/jm-photo.jpg" alt="Jack McKew's Blog" title="Jack McKew's Blog">
      </a>
            <h1><a href="https://jackmckew.dev">Jack McKew's Blog</a></h1>

            <p>Engineer | Software Developer | Data Scientist</p>            <p>Number of Posts: 111</p>
            <p>Number of Words: 82,563</p>
            <p>Number of Lines of Code 5,768</p>
            <form class="navbar-search" action="/search.html" role="search">
                <input type="text" name="q" id="tipue_search_input" placeholder="Search..">
            </form>
            <style>
                .bmc-button img {
                    height: 34px !important;
                    width: 35px !important;
                    margin-bottom: 1px !important;
                    box-shadow: none !important;
                    border: none !important;
                    vertical-align: middle !important;
                }
                
                .bmc-button {
                    margin-top: 15px !important;
                    margin-bottom: 20px !important;
                    padding: 7px 15px 7px 10px !important;
                    line-height: 35px !important;
                    height: 51px !important;
                    text-decoration: none !important;
                    display: inline-flex !important;
                    color: #ffffff !important;
                    /* background-color: #FF813F !important; */
                    border-radius: 5px !important;
                    border: 1px solid transparent !important;
                    padding: 7px 15px 7px 10px !important;
                    font-size: 22px !important;
                    letter-spacing: 0.6px !important;
                    box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;
                    -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
                    font-family: 'Cookie', cursive !important;
                    -webkit-box-sizing: border-box !important;
                    box-sizing: border-box !important;
                }
                
                .bmc-button:hover,
                .bmc-button:active,
                .bmc-button:focus {
                    -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
                    text-decoration: none !important;
                    box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
                    opacity: 0.85 !important;
                    color: #ffffff !important;
                }
            </style>
            <link href="https://fonts.googleapis.com/css?family=Cookie" rel="stylesheet">
            <!-- <a class="bmc-button btn" target="_blank" href="https://www.buymeacoffee.com/jackmckew"><img src="https://jackmckew.dev/theme/img/pizza.png" alt="🍕"><span style="margin-left:5px;font-size:28px !important;">Buy me a Pizza</span></a> -->
            <nav>
                <ul class="list">
                    <li><a target="https://jackmckew.github.io/" href="https://jackmckew.github.io/">Portfolio</a></li>
                    <li><a target="https://jackmckew.dev/files/Jack_McKew_Resume.pdf" href="https://jackmckew.dev/files/Jack_McKew_Resume.pdf">Resume</a></li>
                </ul>
            </nav>

            <ul class="social">
                <li>
                    <a  class="sc-twitter" href="https://twitter.com/Jac_McQ" target="_blank">
                        <i class="fab fa-twitter">
            </i>
                    </a>
                </li>
                <li>
                    <a  class="sc-linkedin" href="https://www.linkedin.com/in/jack-mckew/" target="_blank">
                        <i class="fab fa-linkedin">
            </i>
                    </a>
                </li>
                <li>
                    <a  class="sc-github" href="https://github.com/JackMcKew" target="_blank">
                        <i class="fab fa-github">
            </i>
                    </a>
                </li>
            </ul>
        </div>


    </aside>
    <main>
        <nav>
            <a href="https://jackmckew.dev"> Home</a>             <a href="/archives.html">Archives</a>             <a href="/categories.html">Categories</a>             <a href="/tags.html">Tags</a>             <a href="/sitemap.xml">Sitemap</a>             <a href="https://jackmckew.dev/feeds/all.atom.xml"> Atom</a>         </nav>
<article class="single">
  <header>
      
    <h1 id="portfolio-balancing-with-historical-stock-data">Portfolio Balancing with Historical Stock Data</h1>
    <p>
       Posted on Fri 19 April 2019 in <a href="https://jackmckew.dev/category/python.html">Python</a>

        &#8226; 4 min read
    </p>
  </header>


  <div>
    <body><p>Following last weeks' post (<a href="https://jackmckew.dev/python-for-the-finance-industry.html">Python for the Finance Industry</a>). This post is to demonstrate a method of determining an optimized portfolio based on historical stock price data.</p>
<p>First of all while attempting to tackle this problem, I stumbled across many very informative articles in which based on what I learned throughout reading them, and trying to replicate their findings with the ASX stocks' data.</p>
<ul>
<li>Ricky Kim (<a href="https://towardsdatascience.com/efficient-frontier-portfolio-optimisation-in-python-e7844051e7f">Efficient Frontier Portfolio Optimisation in Python)</a></li>
<li>Bernard Brenyah (<a href="https://medium.com/python-data/effient-frontier-in-python-34b0c3043314">Markowitz’s Efficient Frontier in Python)</a></li>
</ul>
<p>Now I will not be going into how Markowit'z Efficient Frontier Portfolio Optimization &amp; Sharpe Ratios works as these techniques are extremely well documented across this internet and very easily found. This post will be for implementing these techniques in Python to apply them to an ASX based portfolio.</p>
<p>Picking up from the end of the previous post, we had just plotted the percentage change over the time period for our stocks' data. For the sake of this post we will be using a technique called random optimization, where will be taking a number of random attempts and selecting the best one. Further posts will show a more detailed approach to this optimization problem.</p>
<p>Now there are multiple steps before we get to the desired outcome of a balanced portfolio.</p>
<ol>
<li>Generate X number of 'random' portfolios,</li>
<li>Rate their performance against one another,</li>
<li>Pick the desired solution.</li>
</ol>
<p>To generate random portfolios, we define a function such that we can pass it differing variables as to tweak our outcomes in the future.</p>
<table class="table-striped highlighttable table"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_portfolios</span><span class="p">(</span><span class="n">num_portfolios</span><span class="p">,</span><span class="n">average_returns</span><span class="p">,</span><span class="n">covariance_matrix</span><span class="p">,</span><span class="n">risk_free_rate</span><span class="p">):</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="n">num_portfolios</span><span class="p">))</span>
    <span class="n">weights_record</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">portfolio</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_portfolios</span><span class="p">):</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">companies</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">weights</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
        <span class="n">weights_record</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
        <span class="n">returns</span><span class="p">,</span> <span class="n">volatility</span> <span class="o">=</span> <span class="n">portfolio_performance</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span><span class="n">average_returns</span><span class="p">,</span><span class="n">covariance_matrix</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">portfolio</span><span class="p">]</span> <span class="o">=</span> <span class="n">volatility</span>
        <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">portfolio</span><span class="p">]</span> <span class="o">=</span> <span class="n">returns</span>
        <span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">portfolio</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">returns</span> <span class="o">-</span> <span class="n">risk_free_rate</span><span class="p">)</span> <span class="o">/</span> <span class="n">volatility</span>
    <span class="k">return</span> <span class="n">results</span><span class="p">,</span> <span class="n">weights_record</span>
</code></pre></div>
</td></tr></tbody></table>
<p>To step through this function:</p>
<ol>
<li>Define empty location for our portfolio performance results to be stored along with recording weights so we can extract them once selected,</li>
<li>For each portfolio to be generated, give a random 'weighting' for each of the company that we have historical data on (eg, 23% NAB.AX),</li>
<li>Even out the distribution of the weights such that the sum of the weightings is 100% (eg, total budget),</li>
<li>Record the weightings generated in our memory location,</li>
<li>Determine the performance of our randomly generated portfolio (more on that soon),</li>
<li>Fill in the portfolio performance results for this generated portfolio and repeat for X number of portfolios.</li>
</ol>
<p>In step 5 above, we have to determine how to rank the generated portfolios against each other to work out how to filter our results. To do this, we calculate volatility of the portfolio using the following formula:</p>
<p><img alt="\
Assessing the riskiness of a portfolio with Python" class="img-fluid" src="https://cdn-images-1.medium.com/max/1600/1*IabrYvsgHE07z2CJwoE9Zw.jpeg"/></p>
<p><a href="https://medium.com/@bbrenyah">Bernard Brenyah</a>, whom I mentioned at the beginning of the post, has provided a clear explanation of how the above formula can be expressed in matrix calculation in one of <a href="https://medium.com/python-data/assessing-risks-and-return-with-probabilities-of-events-with-python-c564d9be4db4">his blog post</a>s. In which we just take the matrix calculation and multiply by 253 for number of trading days in Australia.</p>
<table class="table-striped highlighttable table"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">portfolio_performance</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span><span class="n">average_returns</span><span class="p">,</span><span class="n">covariance_matrix</span><span class="p">):</span>
    <span class="n">returns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="o">*</span><span class="n">average_returns</span><span class="p">)</span> <span class="o">*</span> <span class="mi">253</span>
    <span class="n">variance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weights</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">covariance_matrix</span><span class="p">,</span><span class="n">weights</span><span class="p">))</span>
    <span class="n">volatility</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">variance</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">253</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">returns</span><span class="p">,</span> <span class="n">volatility</span>
</code></pre></div>
</td></tr></tbody></table>
<p>Now that we have X number of randomly generated portfolios, all ranked against one another, it's time to plot so that our results can be visualized.</p>
<table class="table-striped highlighttable table"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">display_random_efficient_frontier</span><span class="p">(</span><span class="n">average_returns</span><span class="p">,</span><span class="n">covariance_matrix</span><span class="p">,</span><span class="n">num_portfolios</span><span class="p">,</span><span class="n">risk_free_rate</span><span class="p">):</span>
    <span class="n">results</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="n">generate_portfolios</span><span class="p">(</span><span class="n">num_portfolios</span><span class="p">,</span><span class="n">average_returns</span><span class="p">,</span><span class="n">covariance_matrix</span><span class="p">,</span><span class="n">risk_free_rate</span><span class="p">)</span>

    <span class="n">max_sharpe_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">max_volatility</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">max_sharpe_index</span><span class="p">]</span>
    <span class="n">max_return</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">max_sharpe_index</span><span class="p">]</span>
    <span class="n">max_sharpe_allocations</span> <span class="o">=</span> <span class="n">allocations</span><span class="p">(</span><span class="n">max_sharpe_index</span><span class="p">,</span><span class="n">weights</span><span class="p">,</span><span class="n">stocks_df</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"MAX SHARPE RATIO</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Return: </span><span class="si">{0:.2f}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_return</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Volatility: </span><span class="si">{0:.2f}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_volatility</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">max_sharpe_allocations</span><span class="p">)</span>

    <span class="n">min_vol_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">min_volatility</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">min_vol_index</span><span class="p">]</span>
    <span class="n">min_return</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">min_vol_index</span><span class="p">]</span>
    <span class="n">min_vol_allocations</span> <span class="o">=</span> <span class="n">allocations</span><span class="p">(</span><span class="n">min_vol_index</span><span class="p">,</span><span class="n">weights</span><span class="p">,</span><span class="n">stocks_df</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">MINIMUM VOLATILITY</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Return: </span><span class="si">{0:.2f}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">min_return</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Volatility: </span><span class="si">{0:.2f}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">min_volatility</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">min_vol_allocations</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span><span class="n">c</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">,:],</span><span class="n">cmap</span><span class="o">=</span><span class="s1">'YlGnBu'</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'o'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">max_volatility</span><span class="p">,</span><span class="n">max_return</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">'X'</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Maximum Sharpe ratio'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">min_volatility</span><span class="p">,</span><span class="n">min_return</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">'X'</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'y'</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Minimum volatility'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Simulated Portfolio Optimization based on Efficient Frontier'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Volatility'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Returns'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">allocations</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">weights</span><span class="p">,</span><span class="n">stocks_df</span><span class="p">):</span>
    <span class="n">allocation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">index</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="n">stocks_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'allocation'</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">allocation</span>
</code></pre></div>
</td></tr></tbody></table>
<p>Using the above function 'display_random_efficient_frontier', this will determine our max sharpe ratio portfolio generated and the minimum volatility portfolio with their respective returns. Now it is entirely up to the trader on how much risk they are willing to take on board with their portfolio. With the settings below in conjunction with the previously defined functions and stock data to generate the portfolios (risk free rate determined from <a href="http://www.worldgovernmentbonds.com/country/australia/">this website</a>).</p>
<table class="table-striped highlighttable table"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">returns</span> <span class="o">=</span> <span class="n">stocks_df</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>
<span class="n">mean_returns</span> <span class="o">=</span> <span class="n">returns</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">cov_matrix</span> <span class="o">=</span> <span class="n">returns</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
<span class="n">num_portfolios</span> <span class="o">=</span> <span class="mi">25000</span>
<span class="n">risk_free_rate</span> <span class="o">=</span> <span class="mf">0.01977</span>

<span class="n">display_random_efficient_frontier</span><span class="p">(</span><span class="n">mean_returns</span><span class="p">,</span><span class="n">cov_matrix</span><span class="p">,</span><span class="n">num_portfolios</span><span class="p">,</span><span class="n">risk_free_rate</span><span class="p">)</span>
</code></pre></div>
</td></tr></tbody></table>
<p><img alt="sharpe_ratios" class="img-fluid" src="https://jackmckew.dev/img/image-12.png"/></p>
<p><img alt="efficient_frontier" class="img-fluid" src="https://jackmckew.dev/img/image-20.png"/></p>
<p>With the two portfolios determined, the one gives us the best risk-adjusted (as long as the trader is prepared to take the risk) is the one with the maximum Sharpe ratio, allocating a 67% portion to WOW and 32% to BHP, as these stocks were quite volatile from the daily percentage change calculations.</p>
<p>On the other hand, the minimum volatility portfolio is reflecting the more stable of the stocks from the daily percentage change calculations distributing portions over NAB and TLS due to their stability from the percentage change calculations and reducing the portion to WOW.</p></body>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://jackmckew.dev/tag/finance.html">finance</a>
      <a href="https://jackmckew.dev/tag/python.html">python</a>
    </p>
  </div>


  <div class="neighbors">
    <a class="btn float-left" href="https://jackmckew.dev/python-for-the-finance-industry.html" title="Python for the Finance Industry">
      <i class="fa fa-angle-left"></i>  Previous Post
    </a>
    <a class="btn float-right" href="https://jackmckew.dev/efficient-frontier-for-balancing-portfolios.html" title="Efficient Frontier for Balancing Portfolios">
       Next Post <i class="fa fa-angle-right"></i>
    </a>
  </div>

  <div class="related-posts">
    <h4> You might enjoy</h4>
    <ul class="related-posts">
      <li><a href="https://jackmckew.dev/differential-privacy.html">Differential Privacy</a></li>
      <li><a href="https://jackmckew.dev/shallow-vs-deep-copy-in-python.html">Shallow vs Deep Copy in Python</a></li>
      <li><a href="https://jackmckew.dev/types-of-averages-means.html">Types of Averages (Means)</a></li>
      <li><a href="https://jackmckew.dev/dataclasses-vs-attrs-vs-pydantic.html">Dataclasses vs Attrs vs Pydantic</a></li>
      <li><a href="https://jackmckew.dev/generators-in-python.html">Generators in Python</a></li>
    </ul>
  </div>


<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'jackmckew-dev';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
     Please enable JavaScript to view comments.
</noscript>
<!-- End Disqus -->
</article>

        <footer>
<p>&copy;  </p>
<p> Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme</p>        </footer>
    </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Jack McKew's Blog ",
  "url" : "https://jackmckew.dev",
  "image": "/jm-photo.jpg",
  "description": ""
}
</script>    <script>
        $(document).ready(function() {
            $('#tipue_search_input').tipuesearch();
        });
    </script>
</body>

</html>